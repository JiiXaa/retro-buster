{% extends "base.html" %}
{% block content %}

<h1>Show all Rentals in the database</h1>

<button><a href="{{ url_for('rentals.archived_rentals') }}">Archived Rentals</a></button>

{% if rental_data %}
  {% set active_rentals = rental_data|selectattr('date_returned', 'none')|list %}
  {% set returned_rentals = rental_data|rejectattr('date_returned', 'none')|list %}

  <div class="rental_data__container">
    <div class="rental_data__active">
      <h2>Active Rentals</h2>
      {% set active_rentals_found = False %}
      {% for rental in active_rentals %}
        {% if rental.is_removed is none %}
          {% set active_rentals_found = True %}
          <div class="rental_data__item rental_data__item--active">
            <p>Title: {{ rental.vhs_title|title }}</p>
            <p>Copy number: {{ rental.vhs_copy_number }}</p>
            <p>Director: {{ rental.vhs_director|title }}</p>
            <p>Genre: {{ rental.vhs_genre|title }}</p>
            <p>Customer: <a href="{{ url_for('customers.customer_profile', customer_id=rental['customer_id']) }}">{{ rental['customer_name']|title }}</a></p>
            <p>Rent date: {{ rental.date_rented.strftime('%d-%m-%y (%H:%M)') }}</p>
            {% if rental.date_returned %}
              <p>Return date: {{ rental.date_returned.strftime('%d-%m-%y (%H:%M)') }}</p>
            {% else %}
              <p>Due date {{ rental.due_date.strftime('%d-%m-%y') }}</p>
            {% endif %}
            <p>Rent days
              {% if rental.date_returned %}
                {{ (rental.date_returned - rental.date_rented).days }}
              {% else %}
                {{ (today - rental.date_rented).days }}
              {% endif %}
          </div>
          <hr>
          {% endif %}
        {% endfor %}

        {% if not active_rentals_found %}
          <p>No active rentals in the database</p>
        {% endif %}
    </div>

    <div class="rental_data__returned">
      <h2>Returned Rentals</h2>
      {% set returned_rentals_found = False %}
      {% for rental in returned_rentals %}
        {% if rental.is_removed is none %}
          {% set returned_rentals_found = True %}
          <div class="rental_data__item rental_data__item--returned">
            <p>Title: {{ rental.vhs_title|title }}</p>
            <p>Copy number: {{ rental.vhs_copy_number }}</p>
            <p>Director: {{ rental.vhs_director|title }}</p>
            <p>Genre: {{ rental.vhs_genre|title }}</p>
            <p>Customer: <a href="{{ url_for('customers.customer_profile', customer_id=rental['customer_id']) }}">{{ rental['customer_name']|title }}</a></p>
            <p>Rent date: {{ rental.date_rented.strftime('%d-%m-%y (%H:%M)') }}</p>
            {% if rental.date_returned %}
              <p>Return date: {{ rental.date_returned.strftime('%d-%m-%y (%H:%M)') }}</p>
            {% else %}
              <p>Due date {{ rental.due_date.strftime('%d-%m-%y') }}</p>
            {% endif %}
            <p>Rent days
              {% if rental.date_returned %}
                {{ (rental.date_returned - rental.date_rented).days }}
              {% else %}
                {{ (today - rental.date_rented).days }}
              {% endif %}
          </div>
          <hr>
        {% endif %}
        {% endfor %}

        {% if not returned_rentals_found %}
          <p>No returned rentals in the database</p>
        {% endif %}
    </div>

    {% else %}
      <p>No rentals in the database</p>
    {% endif %}
  </div>

{% endblock %}